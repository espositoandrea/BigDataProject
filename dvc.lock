schema: '2.0'
stages:
  cleaning:
    cmd: sh cleaning.sh data/transports/* >data/cleaned.csv
    deps:
    - path: cleaning.sh
      md5: b2c4d990ec4b7b3bb93408b2b6473d04
      size: 358
    - path: data/transports
      md5: 077f74552eca7c022f474924d26c56f7.dir
      size: 280350103
      nfiles: 1012
    params:
      params.yaml:
        clustering.k: 100
        seed: 42
    outs:
    - path: data/cleaned.csv
      md5: c6a47508029621ae8be8853f4f7bd57c
      size: 31507827
  clustering:
    cmd: python clustering.py -m data/clusterer.pkl data/cleaned.csv >data/clustered.csv
    deps:
    - path: clustering.py
      md5: 97358248286b7a85b032ada4dd259f25
      size: 2236
    - path: data/cleaned.csv
      md5: c6a47508029621ae8be8853f4f7bd57c
      size: 31507827
    params:
      params.yaml:
        clustering.k: 100
        seed: 42
    outs:
    - path: data/clustered.csv
      md5: 870c6793983243ac9496371b3c2c5eec
      size: 36820601
    - path: data/clusterer.pkl
      md5: adcca6dc07bb836aa0d56d55fbc6ab67
      size: 501874
  aggregate:
    cmd: python aggregate.py data/clustered.csv >data/aggregates.csv
    deps:
    - path: aggregate.py
      md5: 0cd989947a5526177474751e1abc999d
      size: 4565
    - path: data/clustered.csv
      md5: 870c6793983243ac9496371b3c2c5eec
      size: 36820601
    outs:
    - path: data/aggregates.csv
      md5: baecfc0330a17e9873f41bcb127f7890
      size: 440273104
  time-windows:
    cmd: python time-windows.py data/aggregates.csv -o data/windows
    deps:
    - path: data/aggregates.csv
      md5: baecfc0330a17e9873f41bcb127f7890
      size: 440273104
    - path: time-windows.py
      md5: 70282ae959145b57eada03d39f955e57
      size: 1007
    outs:
    - path: data/windows
      md5: 487fa4ffac1b98ba3791ed0366e1d991.dir
      size: 467782493
      nfiles: 169
  create-train-test:
    cmd: python create-train-test.py data/windows data/train-test
    deps:
    - path: create-train-test.py
      md5: 58d3f6c711f0fd2ed955056ecd4334db
      size: 4056
    - path: data/windows
      md5: 487fa4ffac1b98ba3791ed0366e1d991.dir
      size: 467782493
      nfiles: 169
    params:
      params.yaml:
        create-train-test.perturbed-fraction: 0.1
        seed: 42
    outs:
    - path: data/train-test
      md5: d5c947fcd68d06a7ffa1165fb2ae8e0d.dir
      size: 37754705919
      nfiles: 840
  resizing:
    cmd: python3 resize-train-test.py data/train-test data/resized-train-test
    deps:
    - path: data/train-test
      md5: d5c947fcd68d06a7ffa1165fb2ae8e0d.dir
      size: 37754705919
      nfiles: 840
    - path: resize-train-test.py
      md5: 2f70724c241949d5f26f7f77c4ee7839
      size: 1906
    params:
      params.yaml:
        resize.to-drop:
        - monitoredCall/StopPointName
        - monitoredCall/StopPointRef
    outs:
    - path: data/resized-train-test
      md5: 0c0fe9a5df2067f16392bb627e456da9.dir
      size: 7081513576
      nfiles: 504
